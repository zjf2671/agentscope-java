# AgentScope è°ƒåº¦å™¨æ‰©å±• [Incubating]

## æ¦‚è¿°

AgentScope è°ƒåº¦å™¨æ‰©å±•ä¸º Agent æä¾›å®šæ—¶è°ƒåº¦æ‰§è¡ŒåŠŸèƒ½ï¼Œå…è®¸å®ƒä»¬åœ¨æŒ‡å®šçš„æ—¶é—´æˆ–æ—¶é—´é—´éš”è¿è¡Œã€‚è°ƒåº¦å™¨æ¨¡å—é‡‡ç”¨å¯æ‰©å±•çš„æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§è°ƒåº¦å®ç°ã€‚

*æ³¨ï¼šå½“å‰ç‰ˆæœ¬åŒ…å«åŸºäº **XXL-Job**ï¼ˆåˆ†å¸ƒå¼ï¼‰å’Œ **Quartz**ï¼ˆå•æœº/é›†ç¾¤ï¼‰çš„å®ç°ã€‚*

## æ ¸å¿ƒç‰¹æ€§

- â° **å®šæ—¶è‡ªåŠ¨æ‰§è¡Œ**ï¼šæ”¯æŒ Agent å‘¨æœŸæ€§è‡ªåŠ¨æ‰§è¡Œ
- ğŸ—ï¸ **å¯æ‰©å±•æ¶æ„**ï¼šé€šè¿‡ `AgentScheduler` æ¥å£æ”¯æŒå¤šç§è°ƒåº¦å®ç°
- ğŸŒ **åˆ†å¸ƒå¼è°ƒåº¦**ï¼šè·¨å¤šä¸ªæ‰§è¡Œå™¨å®ä¾‹çš„åˆ†å¸ƒå¼æ‰§è¡Œ
- ğŸ¯ **é›†ä¸­ç®¡ç†**ï¼šé€šè¿‡ç®¡ç†æ§åˆ¶å°ç»Ÿä¸€ç®¡ç† Agent å®šæ—¶è°ƒåº¦
- ğŸ”’ **çŠ¶æ€éš”ç¦»**ï¼šæ¯æ¬¡æ‰§è¡ŒåŠ¨æ€åˆ›å»ºå…¨æ–°çš„ Agent å®ä¾‹
- ğŸ“Š **è¿è¡Œæ—¥å¿—**ï¼šæ”¯æŒ Agent æ‰§è¡Œæ—¥å¿—é‡‡é›†åŠŸèƒ½

## æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é…ç½®å±‚                                â”‚
â”‚  AgentConfig (å« ModelConfig)  +  ScheduleConfig         â”‚
â”‚  (å®šä¹‰ Agent å¦‚ä½•åˆ›å»º)              (å®šä¹‰è°ƒåº¦ç­–ç•¥)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ ä½œä¸ºå‚æ•°ä¼ å…¥
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ ¸å¿ƒæ¥å£å±‚                             â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚   AgentScheduler        â”‚  schedule()    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Task 1 â”‚   â”‚
â”‚  â”‚  â”‚ - schedule()      â”‚  â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”‚ - cancel()        â”‚  â”‚                â”‚ Task 2 â”‚   â”‚
â”‚  â”‚  â”‚ - getScheduledAgent()â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”‚ - shutdown()      â”‚  â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Task N â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           ScheduleAgentTask â”‚
â”‚         (æ¥å£)                           (ä»»åŠ¡æ§åˆ¶ä¸æ‰§è¡Œ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ å¤šç§å®ç°
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ XXL-Job  â”‚ â”‚    Quartz    â”‚ â”‚  Other   â”‚
â”‚    âœ…    â”‚ â”‚      âœ…      â”‚ â”‚    ğŸ”œ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… å·²å®ç°  ğŸ”œ è§„åˆ’ä¸­
```

**æ ¸å¿ƒè®¾è®¡**ï¼š
- **é…ç½®å±‚**ï¼šå®šä¹‰ Agent å…ƒæ•°æ®ä¿¡æ¯å’Œè°ƒåº¦ç­–ç•¥
- **æ¥å£å±‚**ï¼š`AgentScheduler` åˆ›å»ºå¹¶ç®¡ç†å¤šä¸ª `ScheduleAgentTask`
- **å®ç°å±‚**ï¼šåŸºäºä¸åŒæ¡†æ¶å®ç° `AgentScheduler` æ¥å£

## å¿«é€Ÿå¼€å§‹

### 1. æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>io.agentscope</groupId>
    <artifactId>agentscope-extensions-scheduler-xxl-job</artifactId>
    <version>${agentscope.version}</version>
</dependency>
```

### 2. åŸºæœ¬ä½¿ç”¨ï¼ˆXXL-Job å®ç°ï¼‰

**æ­¥éª¤ 1.** éœ€è¦å…ˆéƒ¨ç½² XXL-Job è°ƒåº¦æœåŠ¡ç«¯ã€‚

#### éƒ¨ç½²æ–¹å¼å‚è€ƒï¼šğŸ‘‰ [éƒ¨ç½²å¼€æºæœåŠ¡](https://www.xuxueli.com/xxl-job/)

> **æ³¨æ„**ï¼šæœåŠ¡ç«¯éƒ¨ç½²åï¼Œè·å–å¯¹åº”çš„æœåŠ¡æ®µæ¥å…¥åœ°å€ï¼ˆå¦‚ `http://localhost:8080/xxl-job-admin`ï¼‰ï¼Œåœ¨åç»­é…ç½®ä¸­éœ€è¦ä½¿ç”¨ã€‚

**æ­¥éª¤ 2.** ä¸šåŠ¡åº”ç”¨æ¥å…¥ XXL-Job æœåŠ¡ç«¯ï¼š

åˆå§‹åŒ– XXL-Job Executor å¹¶åˆ›å»ºè°ƒåº¦å™¨å®ä¾‹ï¼Œä½¿å…¶è¿æ¥åˆ° XXL-Job ç®¡ç†æœåŠ¡ç«¯ï¼š

```java
// åˆå§‹åŒ– XXL-Job Executor
XxlJobExecutor executor = new XxlJobExecutor();
executor.setAdminAddresses("http://localhost:8080/xxl-job-admin");  // æ­¥éª¤ 1 ä¸­è·å–çš„æœåŠ¡ç«¯åœ°å€
executor.setAppname("agentscope-demo");                          // åº”ç”¨åç§°ï¼Œéœ€ä¸æœåŠ¡ç«¯é…ç½®ä¸€è‡´
executor.setAccessToken("xxxxxxxx");                                 // è®¿é—®ä»¤ç‰Œï¼ˆå¯é€‰ï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼‰
executor.setPort(9999);                                              // Executor ç«¯å£
executor.start();

// åˆ›å»º AgentScope è°ƒåº¦å™¨å®ä¾‹
AgentScheduler scheduler = new XxlJobAgentScheduler(executor);
```

> **æ³¨æ„**ï¼šExecutor å¯åŠ¨åä¼šè‡ªåŠ¨è¿æ¥åˆ° XXL-Job ç®¡ç†æœåŠ¡ç«¯ï¼Œç¡®ä¿é…ç½®çš„åœ°å€å’Œç«¯å£æ­£ç¡®å¯è®¿é—®ã€‚å­˜é‡å·²æ¥å…¥è¿‡çš„åº”ç”¨åªéœ€åˆ›å»ºå¯¹åº”`AgentScheduler`å³å¯

**æ­¥éª¤ 3.** å®šä¹‰éœ€è¦å®šæ—¶è¿è¡Œçš„ Agentï¼š

åˆ›å»º Agent é…ç½®å¹¶æ³¨å†Œåˆ°è°ƒåº¦å™¨ä¸­ï¼š

```java
// åˆ›å»ºæ¨¡å‹é…ç½®
ModelConfig modelConfig = DashScopeModelConfig.builder()
    .apiKey(apiKey)
    .modelName("qwen-plus")
    .build();

// åˆ›å»º Agent é…ç½®ï¼ˆä»¥ä¸‹ä¸¤ç§æ–¹å¼äºŒé€‰ä¸€ï¼‰

// ã€æ–¹å¼ä¸€ã€‘ä½¿ç”¨ AgentConfig
// é€‚ç”¨äºä¸éœ€è¦ç»‘å®šå·¥å…·é›†çš„åœºæ™¯
AgentConfig agentConfig = AgentConfig.builder()
    .name("MyScheduledAgent")  // Agent åç§°ï¼ˆå°†ä½œä¸º JobHandler åç§°ï¼‰
    .modelConfig(modelConfig)
    .sysPrompt("You are a helpful assistant")  // Agent çš„åŠŸèƒ½æè¿°ä»¥åŠä¸šåŠ¡æ‰§è¡Œæµç¨‹å®šä¹‰
    .build();

// ã€æ–¹å¼äºŒã€‘ä½¿ç”¨ RuntimeAgentConfigï¼ˆé˜¶æ®µæ€§æ–¹æ¡ˆï¼‰
// ä»…å½“éœ€è¦ç»‘å®šå·¥å…·é›†æ—¶ä½¿ç”¨ã€‚RuntimeAgentConfig æ˜¯é˜¶æ®µæ€§äº§ç‰©ï¼Œä¸»è¦ä¸ºäº†ç°é˜¶æ®µå…è®¸ç»‘å®š Tools å·¥å…·é›†
// åç»­ç‰ˆæœ¬ä¼šè°ƒæ•´ toolkit æ³¨å…¥çš„å®šä¹‰æ–¹å¼
RuntimeAgentConfig agentConfig = RuntimeAgentConfig.builder()
    .name("MyScheduledAgent")  // Agent åç§°ï¼ˆå°†ä½œä¸º JobHandler åç§°ï¼‰
    .modelConfig(modelConfig)
    .sysPrompt("You are a helpful assistant")
    .toolkit(toolkit)  // ç»‘å®šå·¥å…·é›†ï¼Œå¦‚ï¼šå‘é€é€šçŸ¥ã€æŠ¥å‘Šæ–‡ä»¶ç”Ÿæˆã€æ•°æ®æ¸…ç†ç­‰
    .build();

// æ³¨å†Œ Agent åˆ°è°ƒåº¦å™¨ï¼Œè®©å…¶èƒ½å¤Ÿè¢«å®šæ—¶è°ƒåº¦æ‰§è¡Œ
ScheduleConfig scheduleConfig = ScheduleConfig.builder().build();
ScheduleAgentTask task = scheduler.schedule(agentConfig, scheduleConfig);
```

> **æ³¨æ„**ï¼šæ³¨å†Œåï¼Œéœ€è¦åœ¨ XXL-Job ç®¡ç†æ§åˆ¶å°ä¸­é…ç½®è¯¥ Agent çš„è°ƒåº¦ç­–ç•¥ï¼ˆCRON è¡¨è¾¾å¼ã€æ‰§è¡Œé¢‘ç‡ç­‰ï¼‰ï¼ŒAgent åç§° `MyScheduledAgent` å°†ä½œä¸º JobHandler åç§°åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºã€‚

**æ­¥éª¤ 4.** åœ¨è°ƒåº¦æ§åˆ¶å°å¯¹Agenté…ç½®å®šæ—¶è¿è¡Œï¼Œå¯æŸ¥çœ‹å…¶è¿è¡Œè¿‡ç¨‹ä¿¡æ¯æ—¥å¿—ï¼š  

ï½œ åˆ›å»ºå¯¹åº”Agentä»»åŠ¡ï¼Œé…ç½®å¯¹åº”å®šæ—¶æ‰§è¡Œå‘¨æœŸ  
![Agentä»»åŠ¡é…ç½®](images/agent-task-config_zh.png)
  
ï½œ æŸ¥çœ‹Agentæ‰§è¡Œæ—¥å¿—ï¼Œå…¶ä¸­ä¼šåŒ…å«Agentæ¯ä¸€æ¬¡è¿è¡Œæ—¶ä¸æ¨¡å‹äº¤äº’äº§ç”Ÿçš„äº‹ä»¶æ—¥å¿—åé¦ˆ  
![Agentè¿è¡Œæ—¥å¿—](images/agent-task-log_zh.png) 

### 3. åŸºæœ¬ä½¿ç”¨ï¼ˆQuartz å®ç°ï¼‰

**æ­¥éª¤ 1.** åˆå§‹åŒ– Quartz è°ƒåº¦å™¨ï¼š

```java
// åˆ›å»º Quartz è°ƒåº¦å™¨å®ä¾‹ï¼ˆå†…ç½®é»˜è®¤é…ç½®ï¼‰
AgentScheduler scheduler = QuartzAgentScheduler.builder()
        .autoStart(true)
        .build();
```

**æ­¥éª¤ 2.** å®šä¹‰ Agent å¹¶é…ç½®è°ƒåº¦ç­–ç•¥ï¼š

```java
// 1. åˆ›å»ºæ¨¡å‹é…ç½®
ModelConfig modelConfig = DashScopeModelConfig.builder()
    .apiKey(apiKey)
    .modelName("qwen-plus")
    .build();

// 2. åˆ›å»º Agent é…ç½®
AgentConfig agentConfig = AgentConfig.builder()
    .name("MyLocalAgent")
    .modelConfig(modelConfig)
    .sysPrompt("You are a helpful assistant")
    .build();

// 3. é…ç½®è°ƒåº¦ç­–ç•¥ï¼ˆä¾‹å¦‚ï¼šæ¯5ç§’æ‰§è¡Œä¸€æ¬¡ï¼‰
ScheduleConfig scheduleConfig = ScheduleConfig.builder()
    .scheduleMode(ScheduleMode.FIXED_RATE)
    .fixedRate(5000L) // 5000ms
    .build();

// 4. æ³¨å†Œä»»åŠ¡
ScheduleAgentTask task = scheduler.schedule(agentConfig, scheduleConfig);
```

**æ­¥éª¤ 3.** ç®¡ç†ä»»åŠ¡ï¼š

```java
// æš‚åœã€æ¢å¤ã€å–æ¶ˆ
scheduler.pause("MyLocalAgent");
scheduler.resume("MyLocalAgent");
scheduler.cancel("MyLocalAgent");

// å…³é—­è°ƒåº¦å™¨
scheduler.shutdown();
``` 

### ç‰¹å®šè°ƒåº¦å™¨å®ç°è¦æ±‚

**å¯¹äº XXL-Job å®ç°ï¼š**
- XXL-Job 2.4.0+ 
- æ¥å…¥äº‘ä¸ŠMSE XXL-JobæœåŠ¡ï¼Œä¸šåŠ¡åº”ç”¨Agentéœ€éƒ¨ç½²ä¸åŒVPC

**å¯¹äºæœªæ¥å®ç°ï¼š**
- å¢åŠ å…¶ä»–å¼€æºå®šæ—¶è¿è¡Œæ–¹æ¡ˆå®ç°
- å¾…å®š

